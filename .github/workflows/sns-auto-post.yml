# SNS Auto Post Workflow
# Phase 3: SNS í¬ìŠ¤íŒ… í•µì‹¬ ë¡œì§
#
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” Notionì—ì„œ Ready ìƒíƒœ ê¸€ì„ ì¡°íšŒí•˜ê³ ,
# SNSìš© ì½˜í…ì¸ ë¡œ ë³€í™˜í•˜ì—¬ Phase 4ì—ì„œ ì‚¬ìš©í•  ë°ì´í„°ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.
#
# íŠ¸ë¦¬ê±°:
#   - ë§¤ì‹œê°„ ì •ê° (Cron)
#   - ìˆ˜ë™ ì‹¤í–‰ (workflow_dispatch)
#
# í•„ìˆ˜ Secrets:
#   - NOTION_API_KEY: Notion Integration í† í°
#   - NOTION_DATABASE_ID: ë¸”ë¡œê·¸ ë°ì´í„°ë² ì´ìŠ¤ ID
#   - NEXT_PUBLIC_BASE_URL: ë¸”ë¡œê·¸ ë„ë©”ì¸
#
# ì„ íƒ Secrets:
#   - AI_GATEWAY_API_KEY: Vercel AI Gateway í‚¤ (ë¯¸ì„¤ì • ì‹œ Fallback ì‚¬ìš©)

name: SNS Auto Post

on:
  schedule:
    - cron: "0 * * * *" # ë§¤ì‹œê°„ ì •ê°
  workflow_dispatch: # ìˆ˜ë™ íŠ¸ë¦¬ê±°
    inputs:
      dry_run:
        description: "Dry run (ì‹¤ì œ í¬ìŠ¤íŒ… ì—†ì´ í…ŒìŠ¤íŠ¸)"
        required: false
        default: "false"
        type: choice
        options:
          - "true"
          - "false"

env:
  # ì½˜í…ì¸  ê¸€ì ìˆ˜ ì œí•œ
  MAX_SHORT_CHARS: 200
  MAX_LONG_CHARS: 400
  # Notion API ë²„ì „
  NOTION_API_VERSION: "2022-06-28"

jobs:
  prepare-content:
    name: Prepare SNS Content
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read

    outputs:
      has_posts: ${{ steps.notion.outputs.has_posts }}
      page_id: ${{ steps.notion.outputs.page_id }}
      title: ${{ steps.notion.outputs.title }}
      post_short: ${{ steps.compose.outputs.post_short }}
      post_long: ${{ steps.compose.outputs.post_long }}
      blog_url: ${{ steps.format.outputs.blog_url }}
      hashtags: ${{ steps.format.outputs.hashtags }}
      transform_method: ${{ steps.compose.outputs.transform_method }}

    steps:
      # ============================================
      # Step 1: Checkout (ì›Œí¬í”Œë¡œìš° íŒŒì¼ ì ‘ê·¼ìš©)
      # ============================================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ============================================
      # Step 2: Notionì—ì„œ Ready ìƒíƒœ ê¸€ ì¡°íšŒ
      # ============================================
      - name: Fetch Ready posts from Notion
        id: notion
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        run: |
          echo "ğŸ“¥ Fetching Ready posts from Notion..."

          # API í‚¤ í™•ì¸
          if [ -z "$NOTION_API_KEY" ] || [ -z "$NOTION_DATABASE_ID" ]; then
            echo "âŒ NOTION_API_KEY or NOTION_DATABASE_ID not configured"
            echo "has_posts=false" >> $GITHUB_OUTPUT
            echo "error=missing_config" >> $GITHUB_OUTPUT
            exit 0
          fi

          # Notion API í˜¸ì¶œ (Status = "Ready" í•„í„°)
          # ì°¸ê³ : í•œê¸€ ì†ì„±ëª… "ìƒíƒœ" ì‚¬ìš©
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            "https://api.notion.com/v1/databases/${NOTION_DATABASE_ID}/query" \
            -H "Authorization: Bearer ${NOTION_API_KEY}" \
            -H "Notion-Version: ${{ env.NOTION_API_VERSION }}" \
            -H "Content-Type: application/json" \
            --data '{
              "filter": {
                "property": "ìƒíƒœ",
                "status": {
                  "equals": "Ready"
                }
              },
              "page_size": 1
            }')

          # HTTP ìƒíƒœ ì½”ë“œ ë¶„ë¦¬
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')

          # API í˜¸ì¶œ ì‹¤íŒ¨ ì²´í¬
          if [ "$HTTP_CODE" != "200" ]; then
            echo "âŒ Notion API returned HTTP $HTTP_CODE"
            echo "$BODY" | jq '.' 2>/dev/null || echo "$BODY"
            echo "has_posts=false" >> $GITHUB_OUTPUT
            echo "error=api_error" >> $GITHUB_OUTPUT
            echo "error_code=$HTTP_CODE" >> $GITHUB_OUTPUT
            exit 0
          fi

          # ê²°ê³¼ ê°œìˆ˜ í™•ì¸
          COUNT=$(echo "$BODY" | jq '.results | length')
          echo "ğŸ“Š Found $COUNT posts with Ready status"

          if [ "$COUNT" -eq 0 ]; then
            echo "has_posts=false" >> $GITHUB_OUTPUT
            echo "âœ… No posts to process"
            exit 0
          fi

          echo "has_posts=true" >> $GITHUB_OUTPUT

          # ì²« ë²ˆì§¸ í¬ìŠ¤íŠ¸ ì¶”ì¶œ
          FIRST_POST=$(echo "$BODY" | jq '.results[0]')
          PAGE_ID=$(echo "$FIRST_POST" | jq -r '.id')

          # ì†ì„± ì¶”ì¶œ (í•œê¸€/ì˜ë¬¸ ì†ì„±ëª… ëª¨ë‘ ì§€ì›)
          # Title: ì´ë¦„ ë˜ëŠ” Name
          TITLE=$(echo "$FIRST_POST" | jq -r '
            .properties["ì´ë¦„"].title[0].plain_text //
            .properties["Name"].title[0].plain_text //
            .properties["ì œëª©"].title[0].plain_text //
            "Untitled"
          ')

          # Description: ì„¤ëª… ë˜ëŠ” Description
          DESCRIPTION=$(echo "$FIRST_POST" | jq -r '
            .properties["ì„¤ëª…"].rich_text[0].plain_text //
            .properties["Description"].rich_text[0].plain_text //
            .properties["ìš”ì•½"].rich_text[0].plain_text //
            ""
          ')

          # Tags: íƒœê·¸ ë˜ëŠ” Tags (ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´)
          TAGS=$(echo "$FIRST_POST" | jq -r '
            [
              .properties["íƒœê·¸"].multi_select[].name //
              .properties["Tags"].multi_select[].name
            ] | join(",")
          ')

          # ì¶œë ¥ (ë©€í‹°ë¼ì¸ ì§€ì›)
          echo "page_id=$PAGE_ID" >> $GITHUB_OUTPUT

          # Title (ë©€í‹°ë¼ì¸ ê°€ëŠ¥ì„± ìˆìŒ)
          echo "title<<EOFTITLE" >> $GITHUB_OUTPUT
          echo "$TITLE" >> $GITHUB_OUTPUT
          echo "EOFTITLE" >> $GITHUB_OUTPUT

          # Description (ë©€í‹°ë¼ì¸)
          echo "description<<EOFDESC" >> $GITHUB_OUTPUT
          echo "$DESCRIPTION" >> $GITHUB_OUTPUT
          echo "EOFDESC" >> $GITHUB_OUTPUT

          echo "tags=$TAGS" >> $GITHUB_OUTPUT

          echo "âœ… Post data extracted:"
          echo "   - ID: $PAGE_ID"
          echo "   - Title: $TITLE"
          echo "   - Tags: $TAGS"
          echo "   - Description length: ${#DESCRIPTION} chars"

      # ============================================
      # Step 3: AI Gateway ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
      # ============================================
      - name: Check AI Gateway availability
        id: check-ai
        if: steps.notion.outputs.has_posts == 'true'
        run: |
          if [ -n "${{ secrets.AI_GATEWAY_API_KEY }}" ]; then
            echo "available=true" >> $GITHUB_OUTPUT
            echo "âœ… AI Gateway is configured"
          else
            echo "available=false" >> $GITHUB_OUTPUT
            echo "âš ï¸ AI Gateway not configured, will use fallback transformation"
          fi

      # ============================================
      # Step 4a: AI Gatewayë¥¼ ì‚¬ìš©í•œ ì½˜í…ì¸  ë³€í™˜
      # ============================================
      - name: Transform content with AI Gateway
        id: transform-ai
        if: steps.notion.outputs.has_posts == 'true' && steps.check-ai.outputs.available == 'true'
        uses: vercel/ai-action@v2
        with:
          model: "openai/gpt-4o"
          api-key: ${{ secrets.AI_GATEWAY_API_KEY }}
          system: |
            ë¸”ë¡œê·¸ ê¸€ì„ SNS í¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

            ê·œì¹™:
            - í•µì‹¬ ë‚´ìš©ë§Œ ê°„ê²°í•˜ê²Œ ìš”ì•½
            - ì´ëª¨ì§€ëŠ” ìµœì†Œí•œìœ¼ë¡œ ì‚¬ìš© (0-2ê°œ)
            - ì „ë¬¸ì ì´ì§€ë§Œ ì¹œê·¼í•œ í†¤ ìœ ì§€
            - í•œêµ­ì–´ë¡œ ì‘ì„±
            - í•´ì‹œíƒœê·¸ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŒ (ë³„ë„ë¡œ ì²˜ë¦¬ë¨)
            - ë¸”ë¡œê·¸ ë§í¬ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŒ (ë³„ë„ë¡œ ì¶”ê°€ë¨)

            short ë²„ì „: X(Twitter)ìš©, 200ì ì´ë‚´ë¡œ í•µì‹¬ë§Œ
            long ë²„ì „: LinkedIn/Threadsìš©, 400ì ì´ë‚´ë¡œ ìƒì„¸í•˜ê²Œ
          prompt: |
            ë‹¤ìŒ ë¸”ë¡œê·¸ ê¸€ì„ SNS í¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.

            ì œëª©: ${{ steps.notion.outputs.title }}

            ë‚´ìš©: ${{ steps.notion.outputs.description }}
          schema: |
            {
              "type": "object",
              "properties": {
                "short": {
                  "type": "string",
                  "description": "X(Twitter)ìš© ì§§ì€ ë²„ì „, 200ì ì´ë‚´"
                },
                "long": {
                  "type": "string",
                  "description": "LinkedIn/Threadsìš© ê¸´ ë²„ì „, 400ì ì´ë‚´"
                }
              },
              "required": ["short", "long"]
            }

      # ============================================
      # Step 4b: AI ë³€í™˜ ê²°ê³¼ ìº¡ì²˜
      # ============================================
      - name: Capture AI transform output
        id: ai-output
        if: steps.transform-ai.outputs.json != ''
        run: |
          echo "âœ… AI transformation complete"

          # JSON ì¶œë ¥ì—ì„œ short/long ì¶”ì¶œ
          SHORT='${{ fromJSON(steps.transform-ai.outputs.json).short }}'
          LONG='${{ fromJSON(steps.transform-ai.outputs.json).long }}'

          # ë©€í‹°ë¼ì¸ ì¶œë ¥
          echo "short<<EOFSHORT" >> $GITHUB_OUTPUT
          echo "$SHORT" >> $GITHUB_OUTPUT
          echo "EOFSHORT" >> $GITHUB_OUTPUT

          echo "long<<EOFLONG" >> $GITHUB_OUTPUT
          echo "$LONG" >> $GITHUB_OUTPUT
          echo "EOFLONG" >> $GITHUB_OUTPUT

          echo "method=ai" >> $GITHUB_OUTPUT

          echo "ğŸ“ Short: ${#SHORT} chars"
          echo "ğŸ“ Long: ${#LONG} chars"

      # ============================================
      # Step 4c: Fallback ë³€í™˜ (AI Gateway ë¯¸ì‚¬ìš© ì‹œ)
      # ============================================
      - name: Fallback transform (No AI)
        id: fallback
        if: steps.notion.outputs.has_posts == 'true' && steps.check-ai.outputs.available == 'false'
        env:
          TITLE: ${{ steps.notion.outputs.title }}
          DESCRIPTION: ${{ steps.notion.outputs.description }}
          MAX_SHORT: ${{ env.MAX_SHORT_CHARS }}
          MAX_LONG: ${{ env.MAX_LONG_CHARS }}
        run: |
          echo "ğŸ”„ Using fallback transformation..."

          # Descriptionì´ ë¹„ì–´ìˆìœ¼ë©´ Title ì‚¬ìš©
          if [ -z "$DESCRIPTION" ]; then
            CONTENT="$TITLE"
          else
            CONTENT="$DESCRIPTION"
          fi

          # ê¸€ì ìˆ˜ ìë¥´ê¸° (UTF-8 ì•ˆì „í•˜ê²Œ)
          # Short ë²„ì „
          SHORT=$(echo "$CONTENT" | head -c ${MAX_SHORT})
          CONTENT_LEN=$(echo "$CONTENT" | wc -c | tr -d ' ')
          if [ "$CONTENT_LEN" -gt "$MAX_SHORT" ]; then
            SHORT="${SHORT}..."
          fi

          # Long ë²„ì „
          LONG=$(echo "$CONTENT" | head -c ${MAX_LONG})
          if [ "$CONTENT_LEN" -gt "$MAX_LONG" ]; then
            LONG="${LONG}..."
          fi

          # ë©€í‹°ë¼ì¸ ì¶œë ¥
          echo "short<<EOFSHORT" >> $GITHUB_OUTPUT
          echo "$SHORT" >> $GITHUB_OUTPUT
          echo "EOFSHORT" >> $GITHUB_OUTPUT

          echo "long<<EOFLONG" >> $GITHUB_OUTPUT
          echo "$LONG" >> $GITHUB_OUTPUT
          echo "EOFLONG" >> $GITHUB_OUTPUT

          echo "method=fallback" >> $GITHUB_OUTPUT

          echo "âœ… Fallback transformation complete"
          echo "ğŸ“ Short: ${#SHORT} chars"
          echo "ğŸ“ Long: ${#LONG} chars"

      # ============================================
      # Step 5: í•´ì‹œíƒœê·¸ ë° ë¸”ë¡œê·¸ URL ìƒì„±
      # ============================================
      - name: Generate hashtags and blog URL
        id: format
        if: steps.notion.outputs.has_posts == 'true'
        env:
          TAGS: ${{ steps.notion.outputs.tags }}
          PAGE_ID: ${{ steps.notion.outputs.page_id }}
          BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}
        run: |
          echo "ğŸ·ï¸ Generating hashtags and URL..."

          # ê¸°ë³¸ URL ì„¤ì • (ë¯¸ì„¤ì • ì‹œ ë¹ˆ ë¬¸ìì—´)
          if [ -z "$BASE_URL" ]; then
            BASE_URL="https://example.com"
            echo "âš ï¸ NEXT_PUBLIC_BASE_URL not set, using placeholder"
          fi

          # í•´ì‹œíƒœê·¸ ë³€í™˜ (ê³µë°± ì œê±°, ìµœëŒ€ 5ê°œ)
          HASHTAGS=""
          if [ -n "$TAGS" ]; then
            IFS=',' read -ra TAG_ARRAY <<< "$TAGS"
            COUNT=0
            for tag in "${TAG_ARRAY[@]}"; do
              if [ $COUNT -ge 5 ]; then break; fi
              # ê³µë°± ì œê±° ë° trim
              clean_tag=$(echo "$tag" | tr -d ' ' | xargs)
              if [ -n "$clean_tag" ]; then
                HASHTAGS="${HASHTAGS}#${clean_tag} "
                COUNT=$((COUNT + 1))
              fi
            done
            HASHTAGS=$(echo "$HASHTAGS" | xargs)  # trim trailing space
          fi

          # ë¸”ë¡œê·¸ URL ìƒì„± (Notion UUID ê·¸ëŒ€ë¡œ ì‚¬ìš©)
          BLOG_URL="${BASE_URL}/blog/${PAGE_ID}"

          echo "hashtags=$HASHTAGS" >> $GITHUB_OUTPUT
          echo "blog_url=$BLOG_URL" >> $GITHUB_OUTPUT

          echo "âœ… Hashtags: $HASHTAGS"
          echo "âœ… Blog URL: $BLOG_URL"

      # ============================================
      # Step 6: ìµœì¢… í¬ìŠ¤íŠ¸ ì½˜í…ì¸  ì¡°ë¦½
      # ============================================
      - name: Compose final posts
        id: compose
        if: steps.notion.outputs.has_posts == 'true'
        env:
          TITLE: ${{ steps.notion.outputs.title }}
          SHORT_AI: ${{ steps.ai-output.outputs.short }}
          LONG_AI: ${{ steps.ai-output.outputs.long }}
          SHORT_FB: ${{ steps.fallback.outputs.short }}
          LONG_FB: ${{ steps.fallback.outputs.long }}
          METHOD_AI: ${{ steps.ai-output.outputs.method }}
          METHOD_FB: ${{ steps.fallback.outputs.method }}
          HASHTAGS: ${{ steps.format.outputs.hashtags }}
          BLOG_URL: ${{ steps.format.outputs.blog_url }}
        run: |
          echo "ğŸ“ Composing final posts..."

          # AI ë˜ëŠ” Fallback ê²°ê³¼ ì„ íƒ
          if [ -n "$SHORT_AI" ]; then
            SHORT="$SHORT_AI"
            LONG="$LONG_AI"
            TRANSFORM_METHOD="ai"
          else
            SHORT="$SHORT_FB"
            LONG="$LONG_FB"
            TRANSFORM_METHOD="fallback"
          fi

          # Xìš© í¬ìŠ¤íŠ¸ (280ì ì œí•œ ê³ ë ¤)
          # í˜•ì‹: ì œëª© + ë³¸ë¬¸ + í•´ì‹œíƒœê·¸ + URL
          POST_SHORT="${TITLE}

          ${SHORT}

          ${HASHTAGS}
          ${BLOG_URL}"

          # LinkedIn/Threadsìš© í¬ìŠ¤íŠ¸
          POST_LONG="${TITLE}

          ${LONG}

          ${HASHTAGS}

          ğŸ”— ${BLOG_URL}"

          # ë©€í‹°ë¼ì¸ ì¶œë ¥
          echo "post_short<<EOFPOSTSHORT" >> $GITHUB_OUTPUT
          echo "$POST_SHORT" >> $GITHUB_OUTPUT
          echo "EOFPOSTSHORT" >> $GITHUB_OUTPUT

          echo "post_long<<EOFPOSTLONG" >> $GITHUB_OUTPUT
          echo "$POST_LONG" >> $GITHUB_OUTPUT
          echo "EOFPOSTLONG" >> $GITHUB_OUTPUT

          echo "transform_method=$TRANSFORM_METHOD" >> $GITHUB_OUTPUT

          echo "âœ… Posts composed successfully"
          echo "ğŸ“ Short post length: $(echo "$POST_SHORT" | wc -c | tr -d ' ') chars"
          echo "ğŸ“ Long post length: $(echo "$POST_LONG" | wc -c | tr -d ' ') chars"

      # ============================================
      # Step 7: ì›Œí¬í”Œë¡œìš° ìš”ì•½ ìƒì„±
      # ============================================
      - name: Generate workflow summary
        if: always()
        env:
          HAS_POSTS: ${{ steps.notion.outputs.has_posts }}
          TITLE: ${{ steps.notion.outputs.title }}
          PAGE_ID: ${{ steps.notion.outputs.page_id }}
          TRANSFORM_METHOD: ${{ steps.compose.outputs.transform_method }}
          BLOG_URL: ${{ steps.format.outputs.blog_url }}
          HASHTAGS: ${{ steps.format.outputs.hashtags }}
          ERROR: ${{ steps.notion.outputs.error }}
          DRY_RUN: ${{ github.event.inputs.dry_run }}
        run: |
          echo "## ğŸ“± SNS Auto Post Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Dry Run í‘œì‹œ
          if [ "$DRY_RUN" = "true" ]; then
            echo "> ğŸ§ª **DRY RUN MODE** - No actual posting will occur" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          echo "| Metric | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY

          if [ "$ERROR" = "missing_config" ]; then
            echo "| Status | âŒ Configuration Error |" >> $GITHUB_STEP_SUMMARY
            echo "| Issue | NOTION_API_KEY or NOTION_DATABASE_ID not set |" >> $GITHUB_STEP_SUMMARY
          elif [ "$ERROR" = "api_error" ]; then
            echo "| Status | âŒ Notion API Error |" >> $GITHUB_STEP_SUMMARY
            echo "| Issue | Failed to query Notion database |" >> $GITHUB_STEP_SUMMARY
          elif [ "$HAS_POSTS" = "true" ]; then
            echo "| Ready Posts Found | âœ… Yes |" >> $GITHUB_STEP_SUMMARY
            echo "| Title | $TITLE |" >> $GITHUB_STEP_SUMMARY
            echo "| Page ID | \`$PAGE_ID\` |" >> $GITHUB_STEP_SUMMARY
            echo "| Transform Method | $TRANSFORM_METHOD |" >> $GITHUB_STEP_SUMMARY
            echo "| Hashtags | $HASHTAGS |" >> $GITHUB_STEP_SUMMARY
            echo "| Blog URL | $BLOG_URL |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Ready Posts Found | âŒ No |" >> $GITHUB_STEP_SUMMARY
            echo "| Status | â­ï¸ Skipped (no posts to process) |" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*Workflow executed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')*" >> $GITHUB_STEP_SUMMARY

      # ============================================
      # Step 8: ì—ëŸ¬ ë°œìƒ ì‹œ Issue ìƒì„±
      # ============================================
      - name: Create issue on Notion API error
        if: steps.notion.outputs.error == 'api_error'
        uses: actions/github-script@v7
        env:
          ERROR_CODE: ${{ steps.notion.outputs.error_code }}
        with:
          script: |
            const errorCode = process.env.ERROR_CODE || 'unknown';

            // ê¸°ì¡´ ì´ìŠˆ í™•ì¸
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'sns-auto-post-error',
              state: 'open'
            });

            if (issues.data.length > 0) {
              console.log('ğŸ“¢ Similar error issue already exists, skipping creation');
              return;
            }

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'âŒ SNS Auto Post: Notion API ì˜¤ë¥˜',
              body: `## Notion API í˜¸ì¶œ ì‹¤íŒ¨

            **HTTP ìƒíƒœ ì½”ë“œ**: ${errorCode}

            **ê°€ëŠ¥í•œ ì›ì¸:**
            - Notion API í‚¤ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ë¨
            - ë°ì´í„°ë² ì´ìŠ¤ IDê°€ ì˜ëª»ë¨
            - Notion Integrationì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°ë˜ì§€ ì•ŠìŒ
            - Notion API ì¼ì‹œì  ì¥ì• 

            **ì¡°ì¹˜ ë°©ë²•:**
            1. GitHub Secretsì—ì„œ \`NOTION_API_KEY\` í™•ì¸
            2. GitHub Secretsì—ì„œ \`NOTION_DATABASE_ID\` í™•ì¸
            3. Notionì—ì„œ Integration ì—°ê²° ìƒíƒœ í™•ì¸
            4. ì›Œí¬í”Œë¡œìš° ìˆ˜ë™ ì¬ì‹¤í–‰

            **ì‹¤í–‰ ë¡œê·¸:** [Actions Run](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})

            ---
            *ì´ ì´ìŠˆëŠ” GitHub Actionsì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*`,
              labels: ['bug', 'sns-auto-post-error']
            });

            console.log('ğŸ“¢ Error issue created');
